---
- name: Configurar contenedor Docker con Ansible (sin AWS)
  hosts: all
  gather_facts: false  # No recopilar facts (m√°s r√°pido)
  connection: community.docker.docker  # Plugin de conexi√≥n Docker

  vars:
    index_title: "Hola desde Ansible + Docker + Terraform"
    index_message: "Configurado 100% con YAML üöÄ"

  tasks:
    - name: Actualizar apt e instalar nginx
      raw: |
        apt-get update -qq && DEBIAN_FRONTEND=noninteractive apt-get install -y -qq nginx curl python3
      # NOTA: instalamos python3 porque Ansible necesita un int√©rprete

    - name: Crear archivo index.html con mensaje
      copy:
        dest: /var/www/html/index.html
        content: |
          <!doctype html>
          <html lang="es">
          <head><meta charset="utf-8"><title>{{ index_title }}</title></head>
          <body style="font-family: system-ui, sans-serif;">
            <h1>{{ index_title }}</h1>
            <p>{{ index_message }}</p>
            <p><strong>Generado por Ansible</strong></p>
          </body>
          </html>

    - name: Iniciar o reiniciar nginx
      shell: |
        if pgrep -x nginx >/dev/null; then
          pkill -HUP nginx
        else
          nginx
        fi